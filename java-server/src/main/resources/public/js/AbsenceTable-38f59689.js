import{R as e,d as a,a1 as l,X as s,u as t,Y as d,c as o,e as u,Z as r,O as n,w as p,k as i,f as m,F as v,z as c,N as f,G as _,V as y,o as b,j as k,y as h,M as I,E,m as Y,P as V,I as j,a2 as D,J as w,D as C,Q as H}from"./index-38c7dff6.js";/* empty css                *//* empty css                    *//* empty css              *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                     *//* empty css            *//* empty css                  *//* empty css               */import{e as M}from"./teachingServ-d54816e4.js";import{r as R}from"./request-3dbfa108.js";const g=async a=>(await e("/api/absence/list",{studentId:a})).data,T={class:"base_form"},x={class:"base_query_oneLine"},L={class:"query_left"},O={key:0,class:"query_right"},A={class:"table_center",style:{"margin-top":"5px"}},$={style:{display:"flex","justify-content":"center","margin-top":"10px"}},N=a({__name:"AbsenceTable",setup(e){const a=l((()=>G.$state.userInfo.roles.includes("ROLE_ADMIN")||G.$state.userInfo.roles.includes("ROLE_TEACHER"))),N=s(!1),U=s([]),q=s(""),B=s([]),S=s({id:0,student:{studentId:"",person:{personId:"",num:""}},reason:"",start:void 0,end:void 0,approved:0,approver:{personId:"",num:""},approvedTime:void 0}),F=()=>{S.value={id:0,student:{studentId:"",person:{personId:"",num:""}},reason:"",start:void 0,end:void 0,approved:0,approver:{personId:"",num:""},approvedTime:void 0}},G=t(),z=()=>{g().then((e=>{B.value=e}))},J=e=>{S.value=e,N.value=!0},P=()=>{var e;S.value.start>S.value.end?I.alert("请假开始时间不能大于请假结束时间"):((e=S.value,R({url:"/api/absence",method:"post",data:e})).then((e=>{N.value=!1,z()})),F())},Q=e=>{(e=>R({url:"/api/absence/approve",method:"post",data:e}))(e).then((e=>{z(),N.value=!1}))},X=e=>{(e=>R({url:"/api/absence/disagree",method:"post",data:e}))(e).then((e=>{z(),N.value=!1}))};return d((()=>{(async()=>{M().then((e=>{U.value=e}))})(),z()})),(e,l)=>{const s=c,t=E,d=Y,I=V,M=f,R=j,z=D,Z=w,K=_,W=C,ee=H,ae=y;return b(),o(v,null,[u("div",T,[l[17]||(l[17]=u("div",{class:"base_header"},[u("div",{class:"blue_column"}),u("div",{class:"base_title"},"考勤管理")],-1)),u("div",x,[u("div",L,[r(G).$state.userInfo.roles.includes("ROLE_STUDENT")?(b(),n(s,{key:0,class:"commButton",type:"primary",onClick:l[0]||(l[0]=e=>(N.value=!0,void F()))},{default:p((()=>l[10]||(l[10]=[k("添加")]))),_:1})):i("",!0)]),r(G).$state.userInfo.roles.includes("ROLE_ADMIN")||r(G).$state.userInfo.roles.includes("ROLE_TEACHER")?(b(),o("div",O,[m(M,{inline:!0},{default:p((()=>[m(I,{label:"学生"},{default:p((()=>[m(d,{modelValue:q.value,"onUpdate:modelValue":l[1]||(l[1]=e=>q.value=e)},{default:p((()=>[(b(!0),o(v,null,h(U.value,(e=>(b(),n(t,{label:e.title,key:e.id,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(I,null,{default:p((()=>[m(s,{type:"default",class:"commButton",onClick:l[2]||(l[2]=e=>{g(q.value).then((e=>{B.value=e}))})},{default:p((()=>l[11]||(l[11]=[k("查询")]))),_:1})])),_:1})])),_:1})])):i("",!0)]),u("div",A,[m(K,{data:B.value},{default:p((()=>[m(R,{label:"id",prop:"id"}),m(R,{label:"学生",prop:"student.numName"}),m(R,{label:"审批状态",prop:"approved"},{default:p((e=>[0===e.row.approved?(b(),n(z,{key:0,type:"warning"},{default:p((()=>l[12]||(l[12]=[k("未审批")]))),_:1})):i("",!0),1===e.row.approved?(b(),n(z,{key:1,type:"success"},{default:p((()=>l[13]||(l[13]=[k("已通过")]))),_:1})):i("",!0),2===e.row.approved?(b(),n(z,{key:2,type:"danger"},{default:p((()=>l[14]||(l[14]=[k("不同意")]))),_:1})):i("",!0)])),_:1}),m(R,{label:"审批人",prop:"approver.name"}),m(R,{label:"审批时间",prop:"approvedTime"}),m(R,{label:"操作"},{default:p((e=>[m(Z,null,{default:p((()=>[r(G).$state.userInfo.roles.includes("ROLE_STUDENT")?(b(),n(s,{key:0,onClick:a=>J(e.row),type:"success",disabled:1===e.row.approved||2===e.row.approved},{default:p((()=>l[15]||(l[15]=[k("编辑")]))),_:2},1032,["onClick","disabled"])):i("",!0),r(G).$state.userInfo.roles.includes("ROLE_ADMIN")||r(G).$state.userInfo.roles.includes("ROLE_TEACHER")?(b(),n(s,{key:1,onClick:a=>J(e.row),type:"success"},{default:p((()=>l[16]||(l[16]=[k("查看学生请假信息")]))),_:2},1032,["onClick"])):i("",!0)])),_:2},1024)])),_:1})])),_:1},8,["data"])])]),m(ae,{id:"favDialog",modelValue:N.value,"onUpdate:modelValue":l[9]||(l[9]=e=>N.value=e),width:"400px"},{header:p((()=>l[18]||(l[18]=[u("h1",null,"学生请假表单",-1)]))),default:p((()=>[m(M,{"label-width":"80px",model:S.value,ref:"form"},{default:p((()=>[m(I,{label:"请假原因"},{default:p((()=>[m(W,{modelValue:S.value.reason,"onUpdate:modelValue":l[3]||(l[3]=e=>S.value.reason=e),type:"textarea",rows:5,disabled:a.value},null,8,["modelValue","disabled"])])),_:1}),m(I,{label:"开始时间"},{default:p((()=>[m(ee,{type:"datetime",modelValue:S.value.start,"onUpdate:modelValue":l[4]||(l[4]=e=>S.value.start=e),placeholder:"选择日期时间",format:"YYYY/MM/DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",disabled:a.value},null,8,["modelValue","disabled"])])),_:1}),m(I,{label:"结束时间"},{default:p((()=>[m(ee,{type:"datetime",modelValue:S.value.end,"onUpdate:modelValue":l[5]||(l[5]=e=>S.value.end=e),placeholder:"选择日期时间",format:"YYYY/MM/DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",disabled:a.value},null,8,["modelValue","disabled"])])),_:1})])),_:1},8,["model"]),u("div",$,[a.value?i("",!0):(b(),n(s,{key:0,type:"primary",onClick:P},{default:p((()=>l[19]||(l[19]=[k("确认")]))),_:1})),a.value?(b(),n(s,{key:1,type:"success",onClick:l[6]||(l[6]=e=>Q(S.value))},{default:p((()=>l[20]||(l[20]=[k("同意")]))),_:1})):i("",!0),a.value?(b(),n(s,{key:2,type:"danger",onClick:l[7]||(l[7]=e=>X(S.value))},{default:p((()=>l[21]||(l[21]=[k("不同意")]))),_:1})):i("",!0),m(s,{onClick:l[8]||(l[8]=e=>N.value=!1)},{default:p((()=>l[22]||(l[22]=[k("取消")]))),_:1})])])),_:1},8,["modelValue"])],64)}}});export{N as default};
