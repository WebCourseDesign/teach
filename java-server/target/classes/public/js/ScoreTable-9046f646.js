import{d as e,u as t,M as a,a5 as s,_ as l,c as r,f as i,e as d,w as o,ah as u,a6 as n,ai as c,af as m,o as p,N as h,k as f,l as I,H as b,I as _,G as y,x as k,a7 as g,n as S,p as L,a0 as v,s as E,aj as w,$ as T,Y as V,X as C}from"./index-ed299ca2.js";/* empty css                *//* empty css              *//* empty css                     *//* empty css                 *//* empty css            *//* empty css             *//* empty css                  *//* empty css               */import{i as N,L as R}from"./index-d3cb131f.js";import{e as U,f as j,h as x,i as D,s as O,j as $}from"./teachingServ-8a53b20e.js";import{m as q,a as z}from"./messageBox-38e2071c.js";import{l as B}from"./lodash-8a6fac22.js";import"./request-1673f500.js";const F=e({data:()=>({scoreList:[],studentId:null,courseId:null,editedItem:{},studentList:[],courseList:[],deleteId:-1,dialogVisible:!1,appStore:t(),radarChart:null,gpa:0}),computed:{},async created(){if(this.initialize(),"ROLE_STUDENT"==this.appStore.$state.userInfo.roles){const e=await a("/api/base/getByUsername",{username:this.appStore.$state.userInfo.username});this.studentId=e.data.studentId,this.query()}},methods:{async initialize(){this.scoreList=await U(this.studentId,this.courseId),this.studentList=await j(),this.courseList=await x();if("ROLE_TEACHER"==t().userInfo.roles){const e=await D();this.courseList=e}},async refresh(){await this.query()},async query(){this.scoreList=await U(this.studentId,this.courseId),this.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")&&this.drawRadarChart()},reset(){"ROLE_STUDENT"!==this.appStore.$state.userInfo.roles&&(this.studentId=null),this.courseId=null,this.query()},checkMark(){return!(this.editedItem.mark<0||this.editedItem.mark>100)},addItem(){this.editedItem={},this.dialogVisible=!0},editItem(e){this.editedItem=B.cloneDeep(e),this.dialogVisible=!0},close(){this.dialogVisible=!1},async confirm(){if(this.close(),null==this.editedItem.studentId||null==this.editedItem.courseId)return void s.alert("学生和课程不能为空");if(!this.editedItem.mark||isNaN(this.editedItem.mark)||this.editedItem.mark<0||this.editedItem.mark>100)return void s.alert("成绩数据非法");const e=await O(this.editedItem.scoreId,this.editedItem.studentId,this.editedItem.courseId,this.editedItem.mark);0==e.code?(q(this,"保存成功"),this.query()):s.alert(e.msg),this.refresh()},async deleteItem(e){if(!(await z("确认删除吗?")))return;const t=await $(e);0==t.code?(q(this,"删除成功"),this.query()):q(this,t.msg)},drawRadarChart(){this.radarChart&&this.radarChart.dispose();const e=document.getElementById("scoreRadarChart");if(!e)return;this.radarChart=N(e);const t=this.scoreList.map((e=>({name:e.courseName,max:100}))),a=this.scoreList.map((e=>"null"===e.mark?0:parseFloat(e.mark))),s={tooltip:{trigger:"item"},legend:{data:["成绩分布"],bottom:0},radar:{center:["50%","50%"],radius:"65%",indicator:t,shape:"circle",splitNumber:5,name:{textStyle:{color:"#333",fontSize:12}},splitLine:{lineStyle:{color:["rgba(238, 197, 102, 0.1)","rgba(238, 197, 102, 0.2)","rgba(238, 197, 102, 0.4)","rgba(238, 197, 102, 0.6)","rgba(238, 197, 102, 0.8)","rgba(238, 197, 102, 1)"].reverse()}},splitArea:{show:!1},axisLine:{lineStyle:{color:"rgba(238, 197, 102, 0.5)"}}},series:[{name:"成绩分布",type:"radar",data:[{value:a,name:"成绩分布",areaStyle:{color:new R(0,0,0,1,[{offset:0,color:"rgba(128, 255, 165, 0.5)"},{offset:1,color:"rgba(1, 191, 236, 0.5)"}])},lineStyle:{width:2,color:"#409EFF"},symbol:"circle",symbolSize:6}]}]};this.radarChart.setOption(s)},handleResize(){var e;null==(e=this.radarChart)||e.resize()}},mounted(){window.addEventListener("resize",this.handleResize)},beforeUnmount(){window.removeEventListener("resize",this.handleResize)}}),M={class:"score-management"},H={class:"control-panel"},A={class:"search-form"},G={class:"main-content"},J={class:"dialog-footer"};const X=l(F,[["render",function(e,t,a,s,l,N){const R=k,U=g,j=S,x=L,D=v,O=n,$=E,q=w,z=T,B=V,F=c,X=C,Y=m;return p(),r("div",M,[t[18]||(t[18]=i("div",{class:"page-header"},[i("div",{class:"blue-bar"}),i("h2",{class:"page-title"},"成绩管理")],-1)),i("div",H,[t[11]||(t[11]=i("div",{class:"action-buttons"},null,-1)),i("div",A,[d(O,{inline:!0,onSubmit:u(e.query,["prevent"])},{default:o((()=>[d(U,null,{default:o((()=>[e.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")?I("",!0):(p(),h(R,{key:0,type:"primary",onClick:t[0]||(t[0]=t=>e.addItem())},{default:o((()=>t[8]||(t[8]=[f(" 添加成绩 ")]))),_:1}))])),_:1}),e.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")?I("",!0):(p(),h(U,{key:0,label:"学生"},{default:o((()=>[d(x,{modelValue:e.studentId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.studentId=t),placeholder:"选择学生",clearable:"",style:{"min-width":"150px"}},{default:o((()=>[(p(!0),r(b,null,_(e.studentList,(e=>(p(),h(j,{label:e.title,key:e.id,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})),d(U,{label:"课程"},{default:o((()=>[d(x,{modelValue:e.courseId,"onUpdate:modelValue":t[2]||(t[2]=t=>e.courseId=t),placeholder:"选择课程",clearable:"",style:{"min-width":"150px"}},{default:o((()=>[(p(!0),r(b,null,_(e.courseList,(e=>(p(),h(j,{label:e.title,key:e.id,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(U,null,{default:o((()=>[d(D,null,{default:o((()=>[d(R,{type:"primary",onClick:e.query},{default:o((()=>t[9]||(t[9]=[f(" 查询 ")]))),_:1},8,["onClick"]),d(R,{onClick:e.reset},{default:o((()=>t[10]||(t[10]=[f(" 重置 ")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])])]),i("div",G,[d(F,{gutter:20},{default:o((()=>[e.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")?(p(),h(q,{key:0,span:e.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")?8:0},{default:o((()=>[d($,{class:"chart-card"},{header:o((()=>t[12]||(t[12]=[i("div",{class:"card-header"},[i("span",null,"成绩分析")],-1)]))),default:o((()=>[t[13]||(t[13]=i("div",{id:"scoreRadarChart",class:"radar-chart"},null,-1))])),_:1})])),_:1},8,["span"])):I("",!0),d(q,{span:e.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")?16:24},{default:o((()=>[d($,{class:"table-card"},{default:o((()=>[d(B,{data:e.scoreList,stripe:"",border:""},{default:o((()=>[e.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")?I("",!0):(p(),h(z,{key:0,label:"学号",prop:"studentNum"})),e.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")?I("",!0):(p(),h(z,{key:1,label:"姓名",prop:"studentName"})),e.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")?I("",!0):(p(),h(z,{key:2,label:"班级",prop:"className"})),d(z,{label:"课程号",prop:"courseNum"}),d(z,{label:"课程名",prop:"courseName"}),d(z,{label:"学分",prop:"credit"}),d(z,{label:"成绩"},{default:o((e=>[f(y("null"==e.row.mark?"未打分":e.row.mark),1)])),_:1}),e.appStore.$state.userInfo.roles.includes("ROLE_STUDENT")?I("",!0):(p(),h(z,{key:3,label:"操作"},{default:o((a=>[d(D,null,{default:o((()=>[d(R,{onClick:t=>e.editItem(a.row),type:"success"},{default:o((()=>t[14]||(t[14]=[f("编辑")]))),_:2},1032,["onClick"]),d(R,{onClick:t=>e.deleteItem(a.row.scoreId),type:"danger"},{default:o((()=>t[15]||(t[15]=[f("删除")]))),_:2},1032,["onClick"])])),_:2},1024)])),_:1}))])),_:1},8,["data"])])),_:1})])),_:1},8,["span"])])),_:1})]),d(Y,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=t=>e.dialogVisible=t),title:e.editedItem.scoreId?"修改成绩":"添加成绩",width:"500px","destroy-on-close":""},{footer:o((()=>[i("div",J,[d(R,{onClick:t[6]||(t[6]=t=>e.dialogVisible=!1)},{default:o((()=>t[16]||(t[16]=[f("取消")]))),_:1}),d(R,{type:"primary",onClick:e.confirm},{default:o((()=>t[17]||(t[17]=[f("确认")]))),_:1},8,["onClick"])])])),default:o((()=>[d(O,{model:e.editedItem,"label-position":"right","label-width":"100px",rules:e.rules,ref:"form"},{default:o((()=>[d(U,{label:"学生"},{default:o((()=>[d(x,{modelValue:e.editedItem.studentId,"onUpdate:modelValue":t[3]||(t[3]=t=>e.editedItem.studentId=t),placeholder:"请选择..."},{default:o((()=>[(p(!0),r(b,null,_(e.studentList,(e=>(p(),h(j,{label:e.title,value:e.value},null,8,["label","value"])))),256))])),_:1},8,["modelValue"])])),_:1}),d(U,{label:"课程名"},{default:o((()=>[d(x,{modelValue:e.editedItem.courseId,"onUpdate:modelValue":t[4]||(t[4]=t=>e.editedItem.courseId=t),placeholder:"请选择..."},{default:o((()=>[(p(!0),r(b,null,_(e.courseList,(e=>(p(),h(j,{label:e.title,value:e.value},null,8,["label","value"])))),256))])),_:1},8,["modelValue"])])),_:1}),d(U,{label:"成绩",prop:"mark",rules:[{required:!0,message:"成绩从0-100",trigger:"blur",validator:e.checkMark}]},{default:o((()=>[d(X,{modelValue:e.editedItem.mark,"onUpdate:modelValue":t[5]||(t[5]=t=>e.editedItem.mark=t),modelModifiers:{number:!0},style:{width:"100%"}},null,8,["modelValue"])])),_:1},8,["rules"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}],["__scopeId","data-v-6a0c175d"]]);export{X as default};
