import{d as e,u as t,a5 as a,_ as l,c as s,f as o,k as r,e as i,w as d,H as u,a6 as m,x as n,Y as c,af as h,o as f,N as p,l as b,I as _,ag as y,a7 as g,X as V,$ as v,a0 as C,n as I,p as x}from"./index-be5cb234.js";/* empty css                *//* empty css            *//* empty css               *//* empty css                     *//* empty css                 *//* empty css              *//* empty css                  */import{g as S,a as L,c as k,d as w,b as j}from"./teachingServ-654619e3.js";import{m as q,a as U}from"./messageBox-168aaa44.js";import{c as N,g as $}from"./changeCourseServ-c7468b55.js";import{l as D}from"./lodash-fb205422.js";import"./request-9dd860e1.js";const A=e({data:()=>({numName:"",courseList:[],courseSelectList:[],deleteId:-1,form:{},dialogVisible:!1,isSelect:0,teacherList:[],tempCourse:{},appStore:t()}),created(){this.query(),this.getState(),this.getTeachers()},methods:{refresh(){this.query(),this.getState(),this.getTeachers()},makeSelectCourseList(){this.courseSelectList=[];for(let e=0;e<this.courseList.length;e++){const t=this.courseList[e];this.courseSelectList.push({id:t.courseId,value:t.num,title:t.num+"-"+t.name})}},async query(){this.appStore.$state.userInfo.roles.includes("ROLE_ADMIN")?this.courseList=await S(this.numName):this.courseList=(await L()).data.data,this.makeSelectCourseList()},addItem(){this.form={teacher:{teacherId:""}},this.dialogVisible=!0},editItem(e){e.teacher||(e.teacher={teacherId:""}),this.form=D.cloneDeep(e),null!=e.preCourse&&(this.form.preCourseId=e.preCourse.courseId),this.dialogVisible=!0},close(){this.dialogVisible=!1},async confirm(){if(!/^sdu\d{4}$/.test(this.form.num))return void a.alert("课程号格式不正确,请以sdu开头加4位数字");if(!this.form.name)return void a.alert("课程名不能为空");if(!this.form.maxCount||!/^\d{1,3}$/.test(this.form.maxCount.toString()))return void a.alert("课容量格式不正确,只能为1-3位整数");if(this.form.maxCount<10)return void a.alert("课容量小于10,无法开课");if(!this.form.credit||!/^([1-9]?\d|100)(\.\d{1})?$/.test(this.form.credit.toString()))return void a.alert("学分格式不正确,只能为一位小数或两位数以内的整数");if(""==this.form.teacher.teacherId)return void a.alert("请选择教师");this.close();const e=await k(this.form);0==e.data.code?(q(this,"保存成功"),this.query()):a.alert(e.data.msg),this.refresh()},async deleteItem(e){if(!(await U("确认删除吗?")))return;const t=await w(e);0==t.code?(q(this,"删除成功"),this.query()):a.alert(t.msg)},submitChange(){N().then((e=>{this.isSelect=e.data.data,this.getState()}))},getState(){$().then((e=>{this.isSelect=e.data.data}))},getTeachers(){j().then((e=>{this.teacherList=e.data.data}))}}}),B={class:"base_form"},E={key:0},M={class:"base_header"},O={class:"base_title"},R={class:"base_query_oneLine"},P={class:"query_left"},T={class:"query_right"},H={class:"query_input"},F={key:1},G={class:"table_center",style:{"margin-top":"5px"}},J={style:{display:"flex","justify-content":"center","margin-top":"10px"}};const K=l(A,[["render",function(e,t,a,l,S,L){const k=y,w=g,j=m,q=n,U=V,N=v,$=C,D=c,A=I,K=x,X=h;return f(),s(u,null,[o("div",B,[e.appStore.$state.userInfo.roles.includes("ROLE_ADMIN")?(f(),s("div",E,[o("div",M,[t[14]||(t[14]=o("div",{class:"blue_column"},null,-1)),o("div",O,[t[13]||(t[13]=r("课程管理 ")),i(j,null,{default:d((()=>[i(w,{label:"·是否选课"},{default:d((()=>[i(k,{"active-text":"开始选课","inactive-text":"停止选课","active-value":1,"inactive-value":0,modelValue:e.isSelect,"onUpdate:modelValue":t[0]||(t[0]=t=>e.isSelect=t),onChange:e.submitChange},null,8,["modelValue","onChange"])])),_:1})])),_:1})])]),o("div",R,[o("div",P,[i(q,{class:"commButton",type:"primary",onClick:t[1]||(t[1]=t=>e.addItem())},{default:d((()=>t[15]||(t[15]=[r("添加")]))),_:1})]),o("div",T,[i(j,null,{default:d((()=>[i(w,{label:"课程号或课程名"},{default:d((()=>[o("div",H,[i(U,{modelValue:e.numName,"onUpdate:modelValue":t[2]||(t[2]=t=>e.numName=t)},null,8,["modelValue"]),i(q,{class:"subButton",type:"default",onClick:t[3]||(t[3]=t=>e.query())},{default:d((()=>t[16]||(t[16]=[r("查询")]))),_:1})])])),_:1})])),_:1})])]),t[17]||(t[17]=o("div",{style:{color:"#930e14","text-align":"center","font-weight":"bold"}}," ps：课序号格式只能为“sduxxxx”，其中x为整数 ",-1))])):(f(),s("div",F,t[18]||(t[18]=[o("div",{class:"base_header"},[o("div",{class:"blue_column"}),o("div",{class:"base_title"},"课程管理")],-1)]))),o("div",G,[i(D,{data:e.courseList,style:{width:"100%"},"label-width":"80px"},{default:d((()=>[i(N,{prop:"num",label:"课程号"}),i(N,{prop:"name",label:"课程名"}),i(N,{prop:"credit",label:"学分"}),i(N,{prop:"coursePath",label:"教材"}),e.appStore.$state.userInfo.roles.includes("ROLE_ADMIN")?(f(),p(N,{key:0,prop:"teacher.person.name",label:"教师"})):b("",!0),i(N,{prop:"preCourse.name",label:"前序课"}),i(N,{prop:"maxCount",label:"课容量"}),e.appStore.$state.userInfo.roles.includes("ROLE_ADMIN")?(f(),p(N,{key:1,label:"操作"},{default:d((a=>[i($,null,{default:d((()=>[i(q,{type:"success",onClick:t=>e.editItem(a.row)},{default:d((()=>t[19]||(t[19]=[r("编辑")]))),_:2},1032,["onClick"]),i(q,{type:"danger",onClick:t=>e.deleteItem(a.row.courseId)},{default:d((()=>t[20]||(t[20]=[r("删除")]))),_:2},1032,["onClick"])])),_:2},1024)])),_:1})):b("",!0)])),_:1},8,["data"])])]),i(X,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[12]||(t[12]=t=>e.dialogVisible=t),width:"300px"},{header:d((()=>t[21]||(t[21]=[o("h1",null,"课程添加修改对话框",-1)]))),default:d((()=>[i(j,{model:e.form,"label-width":"80px"},{default:d((()=>[i(w,{label:"课程号"},{default:d((()=>[i(U,{modelValue:e.form.num,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.num=t),style:{width:"100%"}},null,8,["modelValue"])])),_:1}),i(w,{label:"课程名"},{default:d((()=>[i(U,{modelValue:e.form.name,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.name=t),style:{width:"100%"}},null,8,["modelValue"])])),_:1}),i(w,{label:"学分"},{default:d((()=>[i(U,{modelValue:e.form.credit,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.credit=t),style:{width:"100%"}},null,8,["modelValue"])])),_:1}),i(w,{label:"教材"},{default:d((()=>[i(U,{modelValue:e.form.coursePath,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.coursePath=t),style:{width:"100%"}},null,8,["modelValue"])])),_:1}),i(w,{label:"课容量"},{default:d((()=>[i(U,{modelValue:e.form.maxCount,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.maxCount=t),style:{width:"100%"},type:"number"},null,8,["modelValue"])])),_:1}),i(w,{label:"教师"},{default:d((()=>[i(K,{modelValue:e.form.teacher.teacherId,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.teacher.teacherId=t)},{default:d((()=>[(f(!0),s(u,null,_(e.teacherList,(e=>(f(),p(A,{key:e.teacherId,label:e.person.name,value:e.teacherId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(w,{label:"前序课"},{default:d((()=>[i(K,{modelValue:e.form.preCourseId,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.preCourseId=t),placeholder:"请选择..."},{default:d((()=>[(f(!0),s(u,null,_(e.courseSelectList,(e=>(f(),p(A,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o("div",J,[i(q,{type:"primary",onClick:e.confirm},{default:d((()=>t[22]||(t[22]=[r("确认")]))),_:1},8,["onClick"]),i(q,{onClick:t[11]||(t[11]=t=>e.dialogVisible=!1),style:{"margin-right":"30px"}},{default:d((()=>t[23]||(t[23]=[r("取消")]))),_:1})])])),_:1},8,["model"])])),_:1},8,["modelValue"])],64)}]]);export{K as default};
