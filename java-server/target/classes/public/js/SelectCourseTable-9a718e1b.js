import{d as e,u as a,K as l,L as r,c as s,ak as t,N as o,w as u,l as c,e as d,R as n,an as p,a6 as i,Y as h,o as f,k as m,f as v,ao as b,a7 as _,x as I,$ as E}from"./index-be5cb234.js";/* empty css                     *//* empty css                 *//* empty css            *//* empty css                  *//* empty css              */import{g}from"./teachingServ-654619e3.js";import{g as C,a as k,s as j,c as y}from"./studentServ-6987dbcf.js";import{g as S}from"./changeCourseServ-c7468b55.js";import"./request-9dd860e1.js";const T=e({__name:"SelectCourseTable",setup(e){const T=a(),x=l([]),$={multiple:!0,checkStrictly:!0},w=()=>{k().then((e=>{R.value=e.data.data})).catch((e=>{}))},R=l([]),L=l([]),D=l(),N=l([]),O=l(),U=e=>{if(e&&0!=e){let a=x.value.filter((a=>!!a.preCourse&&a.preCourse.courseId==e)),l=[];return a.forEach((e=>{let a={course:e,label:e.name,value:e.courseId,children:[]};a.children.push(...U(a.course.courseId)),l.push(a)})),l}{let e=x.value.filter((e=>!e.preCourse)),a=[];return e.forEach((e=>{let l={course:e,label:e.name,value:e.courseId,children:[]};l.children.push(...U(l.course.courseId)),a.push(l)})),a}},V=()=>{D.value.forEach((e=>{let a=[];a.push(...e),j(a).then((e=>{0!=e.data.code&&n.error(e.data.msg)})).catch((e=>{n.error("选课失败")})),w()})),w(),w(),D.value=[]},q=l([]),H=e=>{if(e.preCourseId){let a;if(q.value.forEach((l=>{l.courseId==e.courseId&&(a=l)})),a)return a;{let a;return q.value.push(e),x.value.forEach((l=>{l.courseId==e.preCourseId&&(a=l)})),!!a&&H(a)}}},K=()=>{let e=!0;return x.value.forEach((a=>{let l=H(a);l&&(n.error({message:`存在有向环图,课程${l.name}依赖于课程${l.preCourse}`}),e=!1),q.value=[]})),e};return r((()=>{g().then((e=>{x.value=e,K()&&x.value.forEach((e=>{N.value=U(0)}))})).catch((e=>{})),C().then((e=>{L.value=e.data.data})).catch((e=>{})),w(),S().then((e=>{O.value=e.data.data}))})),(e,a)=>{const l=b,r=_,g=p,C=I,k=i,j=h,S=E;return f(),s("div",null,[t(T).$state.userInfo.roles.includes("ROLE_STUDENT")?(f(),o(k,{key:0,inline:!0,disabled:0==O.value},{default:u((()=>[1==O.value?(f(),o(r,{key:0,label:"课程列表"},{default:u((()=>[d(l,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e),options:N.value,props:$,clearable:"",style:{width:"400px"},"collapse-tags":"","collapse-tags-tooltip":"","show-all-levels":"false"},null,8,["modelValue","options"])])),_:1})):(f(),o(r,{key:1},{default:u((()=>[d(g,null,{default:u((()=>a[1]||(a[1]=[m("选课暂未开放，请等待管理员操作")]))),_:1})])),_:1})),d(r,null,{default:u((()=>[d(C,{onClick:V},{default:u((()=>a[2]||(a[2]=[m("选课")]))),_:1})])),_:1})])),_:1},8,["disabled"])):c("",!0),t(T).$state.userInfo.roles.includes("ROLE_TEACHER")?(f(),o(j,{key:1})):c("",!0),d(g,null,{default:u((()=>a[3]||(a[3]=[v("h2",null,"待抽签课程",-1),v("div",{style:{color:"#930e14","text-align":"center","font-weight":"bold"}}," 待教务关闭选课，待抽签课程中被抽中的将进入选中课程列表，选课人数小于等于课程容量的课程将直接进入选中课程列表 ",-1)]))),_:1}),t(T).$state.userInfo.roles.includes("ROLE_STUDENT")?(f(),o(j,{key:2,data:R.value},{default:u((()=>[d(S,{label:"id",prop:"courseId"}),d(S,{label:"课程名称",prop:"name"}),d(S,{label:"课程代码",prop:"num"}),d(S,{label:"学分",prop:"credit"}),d(S,{label:"前序课",prop:"preCourse.name"}),d(S,{label:"老师",prop:"teacher.person.name"}),d(S,{label:"教材",prop:"coursePath"}),d(S,{label:"操作"},{default:u((e=>[d(C,{type:"danger",onClick:a=>{return l=e.row,void y([l.courseId.toString()]).then((e=>{0===e.data.code?(n.success("取消选课成功"),w()):n.error(e.data.msg||"取消选课失败")})).catch((e=>{n.error("取消选课失败")}));var l}},{default:u((()=>a[4]||(a[4]=[m("取消选课")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):c("",!0),d(g,null,{default:u((()=>a[5]||(a[5]=[v("h2",null,"已选中课程",-1)]))),_:1}),t(T).$state.userInfo.roles.includes("ROLE_STUDENT")?(f(),o(j,{key:3,data:L.value},{default:u((()=>[d(S,{label:"id",prop:"courseId"}),d(S,{label:"课程名称",prop:"name"}),d(S,{label:"课程代码",prop:"num"}),d(S,{label:"学分",prop:"credit"}),d(S,{label:"前序课",prop:"preCourse.name"}),d(S,{label:"老师",prop:"teacher.person.name"}),d(S,{label:"教材",prop:"coursePath"})])),_:1},8,["data"])):c("",!0)])}}});export{T as default};
